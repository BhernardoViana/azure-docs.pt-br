---
title: HTTP APIs in Durable Functions - Azure Functions
description: Saiba como implementar APIs HTTP na extensão de Funções Duráveis do Azure Functions.
author: cgillum
ms.topic: conceptual
ms.date: 09/07/2019
ms.author: azfuncdf
ms.openlocfilehash: 0390211e6fc42bd7183a770cac409b880310d317
ms.sourcegitcommit: d6b68b907e5158b451239e4c09bb55eccb5fef89
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/20/2019
ms.locfileid: "74231395"
---
# <a name="http-api-reference"></a>Referência de API HTTP

The Durable Functions extension exposes a set of built-in HTTP APIs that can be used to perform management tasks on [orchestrations](durable-functions-types-features-overview.md#orchestrator-functions), [entities](durable-functions-types-features-overview.md#entity-functions), and [task hubs](durable-functions-task-hubs.md). These HTTP APIs are extensibility webhooks that are authorized by the Azure Functions host but handled directly by the Durable Functions extension.

All HTTP APIs implemented by the extension require the following parameters. O tipo de dados de todos os parâmetros é `string`.

| .        | Tipo de Parâmetro  | Descrição |
|------------------|-----------------|-------------|
| **`taskHub`**    | Cadeia de consulta    | O nome do [hub de tarefas](durable-functions-task-hubs.md). Se não for especificado, o nome do hub de tarefas do aplicativo de funções será presumido. |
| **`connection`** | Cadeia de consulta    | O **nome** da cadeia de conexão para a conta de armazenamento. Se não for especificada, a cadeia de conexão padrão do aplicativo de funções será presumida. |
| **`systemKey`**  | Cadeia de consulta    | A chave de autorização necessária para invocar a API. |

`systemKey` is an authorization key autogenerated by the Azure Functions host. Ela concede acesso especificamente às APIs da extensão de Tarefas Duráveis e pode ser gerenciada da mesma maneira que as [outras chaves de autorização](https://github.com/Azure/azure-webjobs-sdk-script/wiki/Key-management-API). You can generate URLs that contain the correct `taskHub`, `connection`, and `systemKey` query string values using [orchestration client binding](durable-functions-bindings.md#orchestration-client) APIs, such as the `CreateCheckStatusResponse` and `CreateHttpManagementPayload` APIs in .NET, or the `createCheckStatusResponse` and `createHttpManagementPayload` APIs in JavaScript.

As próximas seções tratam das APIs HTTP específicas com suporte da extensão e fornecem exemplos de como elas podem ser usadas.

## <a name="start-orchestration"></a>Start orchestration

Starts executing a new instance of the specified orchestrator function.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/orchestrators/{functionName}/{instanceId?}
     ?taskHub={taskHub}
     &connection={connectionName}
     &code={systemKey}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo              | Tipo de parâmetro  | Descrição |
|--------------------|-----------------|-------------|
| **`functionName`** | URL             | The name of the orchestrator function to start. |
| **`instanceId`**   | URL             | Parâmetro opcional. A ID da instância de orquestração. If not specified, the orchestrator function will start with a random instance ID. |
| **`{content}`**    | Conteúdo da solicitação | Opcional. The JSON-formatted orchestrator function input. |

### <a name="response"></a>Resposta

Vários valores de código de status possíveis podem ser retornados.

* **HTTP 202 (Accepted)** : The specified orchestrator function was scheduled to start running. The `Location` response header contains a URL for polling the orchestration status.
* **HTTP 400 (Bad request)** : The specified orchestrator function doesn't exist, the specified instance ID was not valid, or request content was not valid JSON.

The following is an example request that starts a `RestartVMs` orchestrator function and includes  JSON object payload:

```http
POST /runtime/webhooks/durabletask/orchestrators/RestartVMs?code=XXX
Content-Type: application/json
Content-Length: 83

{
    "resourceGroup": "myRG",
    "subscriptionId": "111deb5d-09df-4604-992e-a968345530a9"
}
```

The response payload for the **HTTP 202** cases is a JSON object with the following fields:

| Campo                       | Descrição                          |
|-----------------------------|--------------------------------------|
| **`id`**                    |A ID da instância de orquestração. |
| **`statusQueryGetUri`**     |A URL de status da instância de orquestração. |
| **`sendEventPostUri`**      |A URL "acionar evento" da instância de orquestração. |
| **`terminatePostUri`**      |A URL "encerrar" da instância de orquestração. |
| **`purgeHistoryDeleteUri`** |The "purge history" URL of the orchestration instance. |
| **`rewindPostUri`**         |(preview) The "rewind" URL of the orchestration instance. |

O tipo de dados de todos os campos é `string`.

Here is an example response payload for an orchestration instance with `abc123` as its ID (formatted for readability):

```http
{
    "id": "abc123",
    "purgeHistoryDeleteUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "sendEventPostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/raiseEvent/{eventName}?code=XXX",
    "statusQueryGetUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123?code=XXX",
    "terminatePostUri": "http://localhost:7071/runtime/webhooks/durabletask/instances/abc123/terminate?reason={text}&code=XXX"
}
```

The http response is intended to be compatible with the *Polling Consumer Pattern*. It also includes the following notable response headers:

* **Location**: The URL of the status endpoint. This URL contains the same value as the `statusQueryGetUri` field.
* **Retry-After**: The number of seconds to wait between polling operations. O valor padrão é `10`.

For more information on the asynchronous HTTP polling pattern, see the [HTTP async operation tracking](durable-functions-http-features.md#async-operation-tracking) documentation.

## <a name="get-instance-status"></a>Obter status da instância

Obtém o status de uma instância de orquestração especificada.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &showHistory=[true|false]
    &showHistoryOutput=[true|false]
    &showInput=[true|false]
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo                   | Tipo de parâmetro  | Descrição |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | A ID da instância de orquestração. |
| **`showInput`**         | Cadeia de consulta    | Parâmetro opcional. If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | Cadeia de consulta    | Parâmetro opcional. Se definido como `true`, o histórico de execução da orquestração será incluído na carga da resposta.|
| **`showHistoryOutput`** | Cadeia de consulta    | Parâmetro opcional. If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | Cadeia de consulta    | Parâmetro opcional. Quando especificado, filtra a lista de instâncias retornadas com base em seu status de runtime. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

### <a name="response"></a>Resposta

Vários valores de código de status possíveis podem ser retornados.

* **HTTP 200 (OK)** : a instância especificada está em um estado concluído.
* **HTTP 202 (Aceito)** : a instância especificada está em andamento.
* **HTTP 400 (Solicitação incorreta)** : a instância especificada falhou ou foi encerrada.
* **HTTP 404 (Não encontrado)** : a instância especificada não existe ou não começou a ser executada.
* **HTTP 500 (erro interno do servidor)** : A instância especificada falhou com uma exceção sem tratamento.

A carga de resposta para os casos de **HTTP 200** e **HTTP 202** é um objeto JSON com os campos a seguir:

| Campo                 | Tipo de dados | Descrição |
|-----------------------|-----------|-------------|
| **`runtimeStatus`**   | string    | O status de runtime da instância. Os valores incluem *Em execução*, *Pendente*, *Falha*, *Cancelado*, *Encerrado*, *Concluído*. |
| **`input`**           | JSON      | Os dados JSON usados para inicializar a instância. Este campo é `null` se o `showInput` parâmetro da cadeia de caracteres de consulta for definido para `false`.|
| **`customStatus`**    | JSON      | Os dados JSON usados para status de orquestração personalizado. Este campo é `null` se não for definido. |
| **`output`**          | JSON      | A saída JSON da instância. Este campo será `null` se a instância não estiver no estado concluído. |
| **`createdTime`**     | string    | A hora em que a instância foi criada. Usa a notação estendida ISO 8601. |
| **`lastUpdatedTime`** | string    | A hora em que a instância foi persistida pela última vez. Usa a notação estendida ISO 8601. |
| **`historyEvents`**   | JSON      | Uma matriz JSON contendo o histórico de execução da orquestração. Esse campo é `null`, exceto se o parâmetro da cadeia de caracteres de consulta `showHistory` estiver definido como `true`. |

Aqui está um exemplo de carga de resposta, incluindo o histórico de execução de orquestração e saídas de atividades (formatado para legibilidade):

```json
{
  "createdTime": "2018-02-28T05:18:49Z",
  "historyEvents": [
      {
          "EventType": "ExecutionStarted",
          "FunctionName": "E1_HelloSequence",
          "Timestamp": "2018-02-28T05:18:49.3452372Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Tokyo!",
          "ScheduledTime": "2018-02-28T05:18:51.3939873Z",
          "Timestamp": "2018-02-28T05:18:52.2895622Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello Seattle!",
          "ScheduledTime": "2018-02-28T05:18:52.8755705Z",
          "Timestamp": "2018-02-28T05:18:53.1765771Z"
      },
      {
          "EventType": "TaskCompleted",
          "FunctionName": "E1_SayHello",
          "Result": "Hello London!",
          "ScheduledTime": "2018-02-28T05:18:53.5170791Z",
          "Timestamp": "2018-02-28T05:18:53.891081Z"
      },
      {
          "EventType": "ExecutionCompleted",
          "OrchestrationStatus": "Completed",
          "Result": [
              "Hello Tokyo!",
              "Hello Seattle!",
              "Hello London!"
          ],
          "Timestamp": "2018-02-28T05:18:54.3660895Z"
      }
  ],
  "input": null,
  "customStatus": { "nextActions": ["A", "B", "C"], "foo": 2 },
  "lastUpdatedTime": "2018-02-28T05:18:54Z",
  "output": [
      "Hello Tokyo!",
      "Hello Seattle!",
      "Hello London!"
  ],
  "runtimeStatus": "Completed"
}
```

A resposta **HTTP 202** também inclui um cabeçalho de resposta **Local** que faz referência à mesma URL que o campo `statusQueryGetUri` mencionado anteriormente.

## <a name="get-all-instances-status"></a>Obter status de todas as instâncias

You can also query the status of all instances by removing the `instanceId` from the 'Get instance status' request. In this case, the basic parameters are the same as the 'Get instance status'. Query string parameters for filtering are also supported.

Uma coisa a lembrar é que `connection` e `code` são opcionais. If you have anonymous auth on the function, then `code` isn't required.
If you don't want to use a different storage connection string other than defined in the AzureWebJobsStorage app setting, then you can safely ignore the connection query string parameter.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
GET /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
GET /runtime/webhooks/durableTask/instances?
    taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
    &showInput=[true|false]
    &top={integer}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo                   | Tipo de parâmetro  | Descrição |
|-------------------------|-----------------|-------------|
| **`instanceId`**        | URL             | A ID da instância de orquestração. |
| **`showInput`**         | Cadeia de consulta    | Parâmetro opcional. If set to `false`, the function input will not be included in the response payload.|
| **`showHistory`**       | Cadeia de consulta    | Parâmetro opcional. Se definido como `true`, o histórico de execução da orquestração será incluído na carga da resposta.|
| **`showHistoryOutput`** | Cadeia de consulta    | Parâmetro opcional. If set to `true`, the function outputs will be included in the orchestration execution history.|
| **`createdTimeFrom`**   | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of returned instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**     | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of returned instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**     | Cadeia de consulta    | Parâmetro opcional. Quando especificado, filtra a lista de instâncias retornadas com base em seu status de runtime. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |
| **`top`**               | Cadeia de consulta    | Parâmetro opcional. When specified, limits the number of instances returned by the query. |

### <a name="response"></a>Resposta

Aqui está um exemplo de cargas de resposta, incluindo o status de orquestração (formatado para legibilidade):

```json
[
    {
        "instanceId": "7af46ff000564c65aafbfe99d07c32a5",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:39Z",
        "lastUpdatedTime": "2018-06-04T10:46:47Z"
    },
    {
        "instanceId": "80eb7dd5c22f4eeba9f42b062794321e",
        "runtimeStatus": "Running",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:28Z",
        "lastUpdatedTime": "2018-06-04T15:18:38Z"
    },
    {
        "instanceId": "9124518926db408ab8dfe84822aba2b1",
        "runtimeStatus": "Completed",
        "input": null,
        "customStatus": null,
        "output": [
            "Hello Tokyo!",
            "Hello Seattle!",
            "Hello London!"
        ],
        "createdTime": "2018-06-04T10:46:54Z",
        "lastUpdatedTime": "2018-06-04T10:47:03Z"
    },
    {
        "instanceId": "d100b90b903c4009ba1a90868331b11b",
        "runtimeStatus": "Pending",
        "input": null,
        "customStatus": null,
        "output": null,
        "createdTime": "2018-06-04T15:18:39Z",
        "lastUpdatedTime": "2018-06-04T15:18:39Z"
    }
]
```

> [!NOTE]
> Essa operação pode ser muito cara em termos de E/S de Armazenamento do Microsoft Azure, se houver muitas linhas na tabela Instâncias. Mais detalhes sobre a tabela de Instâncias podem ser encontrados na documentação [Desempenho e escala nas Funções Duráveis (Azure Functions)](durable-functions-perf-and-scale.md#instances-table).
>

If more results exist, a continuation token is returned in the response header.  O nome do cabeçalho `x-ms-continuation-token`.

If you set continuation token value in the next request header, you can get the next page of results. This name of the request header is also `x-ms-continuation-token`.

## <a name="purge-single-instance-history"></a>Purge single instance history

Deletes the history and related artifacts for a specified orchestration instance.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances/{instanceId}
    ?taskHub={taskHub}
    &connection={connection}
    &code={systemKey}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo             | Tipo de parâmetro  | Descrição |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | A ID da instância de orquestração. |

### <a name="response"></a>Resposta

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : The specified instance doesn't exist.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| Campo                  | Tipo de dados | Descrição |
|------------------------|-----------|-------------|
| **`instancesDeleted`** | inteiro   | The number of instances deleted. For the single instance case, this value should always be `1`. |

Veja um exemplo de carga de resposta (formatada para facilitar a leitura):

```json
{
    "instancesDeleted": 1
}
```

## <a name="purge-multiple-instance-histories"></a>Purge multiple instance histories

You can also delete the history and related artifacts for multiple instances within a task hub by removing the `{instanceId}` from the 'Purge single instance history' request. To selectively purge instance history, use the same filters described in the 'Get all instances status' request.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
DELETE /admin/extensions/DurableTaskExtension/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
DELETE /runtime/webhooks/durabletask/instances
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &createdTimeFrom={timestamp}
    &createdTimeTo={timestamp}
    &runtimeStatus={runtimeStatus1,runtimeStatus2,...}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo                 | Tipo de parâmetro  | Descrição |
|-----------------------|-----------------|-------------|
| **`createdTimeFrom`** | Cadeia de consulta    | Filters the list of purged instances that were created at or after the given ISO8601 timestamp.|
| **`createdTimeTo`**   | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of purged instances that were created at or before the given ISO8601 timestamp.|
| **`runtimeStatus`**   | Cadeia de consulta    | Parâmetro opcional. When specified, filters the list of purged instances based on their runtime status. To see the list of possible runtime status values, see the [Querying instances](durable-functions-instance-management.md) article. |

> [!NOTE]
> This operation can be very expensive in terms of Azure Storage I/O if there are a lot of rows in the Instances and/or History tables. More details on these tables can be found in the [Performance and scale in Durable Functions (Azure Functions)](durable-functions-perf-and-scale.md#instances-table) documentation.

### <a name="response"></a>Resposta

The following HTTP status code values can be returned.

* **HTTP 200 (OK)** : The instance history has been purged successfully.
* **HTTP 404 (Not Found)** : No instances were found that match the filter expression.

The response payload for the **HTTP 200** case is a JSON object with the following field:

| Campo                   | Tipo de dados | Descrição |
|-------------------------|-----------|-------------|
| **`instancesDeleted`**  | inteiro   | The number of instances deleted. |

Veja um exemplo de carga de resposta (formatada para facilitar a leitura):

```json
{
    "instancesDeleted": 250
}
```

## <a name="raise-event"></a>Acionar evento

Envia uma mensagem de notificação de evento para uma instância de orquestração em execução.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/raiseEvent/{eventName}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo             | Tipo de parâmetro  | Descrição |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | A ID da instância de orquestração. |
| **`eventName`**   | URL             | O nome do evento que a instância de orquestração de destino está esperando. |
| **`{content}`**   | Conteúdo da solicitação | A carga do evento em formato JSON. |

### <a name="response"></a>Resposta

Vários valores de código de status possíveis podem ser retornados.

* **HTTP 202 (Aceito)** : o evento gerado foi aceito para processamento.
* **HTTP 400 (Solicitação incorreta)** : o conteúdo da solicitação não era do tipo `application/json` ou não era um JSON válido.
* **HTTP 404 (Não encontrado)** : a instância especificada não foi encontrada.
* **HTTP 410 (Não existe mais)** : a instância especificada foi concluída ou falhou e não pode processar os eventos gerados.

Veja um exemplo de solicitação que envia a cadeia de caracteres JSON `"incr"` para uma instância que aguarda um evento nomeado **operation**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/raiseEvent/operation?taskHub=DurableFunctionsHub&connection=Storage&code=XXX
Content-Type: application/json
Content-Length: 6

"incr"
```

As respostas para esta API não têm nenhum conteúdo.

## <a name="terminate-instance"></a>Encerrar instância

Encerra uma instância de orquestração em execução.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/terminate
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o seguinte parâmetro exclusivo.

| Campo             | Tipo de Parâmetro  | Descrição |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | A ID da instância de orquestração. |
| **`reason`**      | Cadeia de consulta    | Opcional. O motivo para encerrar a instância de orquestração. |

### <a name="response"></a>Resposta

Vários valores de código de status possíveis podem ser retornados.

* **HTTP 202 (Aceito)** : a solicitação de encerramento foi aceita para processamento.
* **HTTP 404 (Não encontrado)** : a instância especificada não foi encontrada.
* **HTTP 410 (Não existe mais)** : a instância especificada foi concluída ou falhou.

Veja um exemplo de solicitação que encerra uma instância em execução e especifica o motivo **buggy**:

```
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/terminate?reason=buggy&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

As respostas para esta API não têm nenhum conteúdo.

## <a name="rewind-instance-preview"></a>Instância Gerenciada (versão prévia)

Restaura uma instância de orquestração com falha em um estado de execução ao reproduzir novamente as operações com falha mais recentes.

### <a name="request"></a>Solicitação

For version 1.x of the Functions runtime, the request is formatted as follows (multiple lines are shown for clarity):

```http
POST /admin/extensions/DurableTaskExtension/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

In version 2.x of the Functions runtime, the URL format has all the same parameters but with a slightly different prefix:

```http
POST /runtime/webhooks/durabletask/instances/{instanceId}/rewind
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &reason={text}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o seguinte parâmetro exclusivo.

| Campo             | Tipo de Parâmetro  | Descrição |
|-------------------|-----------------|-------------|
| **`instanceId`**  | URL             | A ID da instância de orquestração. |
| **`reason`**      | Cadeia de consulta    | Opcional. O motivo para retroceder a instância de orquestração. |

### <a name="response"></a>Resposta

Vários valores de código de status possíveis podem ser retornados.

* **HTTP 202 (Aceito)** : a solicitação de retroceder foi aceita para processamento.
* **HTTP 404 (Não encontrado)** : a instância especificada não foi encontrada.
* **HTTP 410 (Não existe mais)** : a instância especificada foi concluída ou falhou.

Veja um exemplo de solicitação que retrocede uma instância com falha e especifica o motivo **corrigido**:

```http
POST /admin/extensions/DurableTaskExtension/instances/bcf6fb5067b046fbb021b52ba7deae5a/rewind?reason=fixed&taskHub=DurableFunctionsHub&connection=Storage&code=XXX
```

As respostas para esta API não têm nenhum conteúdo.

## <a name="signal-entity"></a>Signal entity

Sends a one-way operation message to a [Durable Entity](durable-functions-types-features-overview.md#entity-functions). If the entity doesn't exist, it will be created automatically.

> [!NOTE]
> Durable entities are available starting in Durable Functions 2.0.

### <a name="request"></a>Solicitação

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
POST /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
    &op={operationName}
```

Parâmetros de solicitação para essa API incluem o conjunto padrão mencionado anteriormente, bem como o parâmetro exclusivo a seguir:

| Campo             | Tipo de parâmetro  | Descrição |
|-------------------|-----------------|-------------|
| **`entityType`**  | URL             | The type of the entity. |
| **`entityKey`**   | URL             | The unique name of the entity. |
| **`op`**          | Cadeia de consulta    | Opcional. The name of the user-defined operation to invoke. |
| **`{content}`**   | Conteúdo da solicitação | A carga do evento em formato JSON. |

Here is an example request that sends a user-defined "Add" message to a `Counter` entity named `steps`. The content of the message is the value `5`. If the entity does not already exist, it will be created by this request:

```http
POST /runtime/webhooks/durabletask/entities/Counter/steps?op=Add
Content-Type: application/json

5
```

### <a name="response"></a>Resposta

This operation has several possible responses:

* **HTTP 202 (Accepted)** : The signal operation was accepted for asynchronous processing.
* **HTTP 400 (Bad request)** : The request content was not of type `application/json`, was not valid JSON, or had an invalid `entityKey` value.
* **HTTP 404 (Not Found)** : The specified `entityType` was not found.

A successful HTTP request does not contain any content in the response. A failed HTTP request may contain JSON-formatted error information in the response content.

## <a name="query-entity"></a>Query entity

Gets the state of the specified entity.

### <a name="request"></a>Solicitação

The HTTP request is formatted as follows (multiple lines are shown for clarity):

```http
GET /runtime/webhooks/durabletask/entities/{entityType}/{entityKey}
    ?taskHub={taskHub}
    &connection={connectionName}
    &code={systemKey}
```

### <a name="response"></a>Resposta

This operation has two possible responses:

* **HTTP 200 (OK)** : The specified entity exists.
* **HTTP 404 (Not Found)** : The specified entity was not found.

A successful response contains the JSON-serialized state of the entity as its content.

### <a name="example"></a>Exemplo
The following example HTTP request gets the state of an existing `Counter` entity named `steps`:

```http
GET /runtime/webhooks/durabletask/entities/Counter/steps
```

If the `Counter` entity simply contained a number of steps saved in a `currentValue` field, the response content might look like the following (formatted for readability):

```json
{
    "currentValue": 5
}
```

## <a name="next-steps"></a>Próximos passos

> [!div class="nextstepaction"]
> [Learn how to use Application Insights to monitor your durable functions](durable-functions-diagnostics.md)